<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-04-23T13:00:01.830181757"><title>Create an app using C interop and libcurl &ndash; tutorial | Kotlin</title><script type="application/json" id="virtual-toc-data">[{"id":"before-you-start","level":0,"title":"Before you start","anchor":"#before-you-start"},{"id":"create-a-definition-file","level":0,"title":"Create a definition file","anchor":"#create-a-definition-file"},{"id":"add-interoperability-to-the-build-process","level":0,"title":"Add interoperability to the build process","anchor":"#add-interoperability-to-the-build-process"},{"id":"write-the-application-code","level":0,"title":"Write the application code","anchor":"#write-the-application-code"},{"id":"compile-and-run-the-application","level":0,"title":"Compile and run the application","anchor":"#compile-and-run-the-application"},{"id":"what-s-next","level":0,"title":"What\u0027s next","anchor":"#what-s-next"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="frontend/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="icon" type="image/png" sizes="32x32" href="writerside_32.png"><link rel="icon" type="image/png" sizes="64x64" href="writerside_64.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Create an app using C interop and libcurl &ndash; tutorial | Kotlin"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Kotlin Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/native-app-with-c-and-libcurl.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Create an app using C interop and libcurl &ndash; tutorial | Kotlin"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/native-app-with-c-and-libcurl.html#webpage",
    "url": "writerside-documentation/native-app-with-c-and-libcurl.html",
    "name": "Create an app using C interop and libcurl &ndash; tutorial | Kotlin",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Kotlin Help"
}</script><!-- End Schema.org --></head><body data-id="native-app-with-c-and-libcurl" data-main-title="Create an app using C interop and libcurl – tutorial" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="Platforms///Native///C interop"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Kotlin  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="native-app-with-c-and-libcurl" id="native-app-with-c-and-libcurl.md">Create an app using C interop and libcurl – tutorial</h1><p id="xwv5fd_2">This tutorial demonstrates how to use IntelliJ IDEA to create a command-line application. You'll learn how to create a simple HTTP client that can run natively on specified platforms using Kotlin/Native and the libcurl library.</p><p id="xwv5fd_3">The output will be an executable command-line app that you can run on macOS and Linux and make simple HTTP GET requests.</p><p id="xwv5fd_4">You can use the command line to generate a Kotlin library, either directly or with a script file (such as <code class="code" id="xwv5fd_11">.sh</code> or <code class="code" id="xwv5fd_12">.bat</code> file). However, this approach doesn't scale well for larger projects that have hundreds of files and libraries. Using a build system simplifies the process by downloading and caching the Kotlin/Native compiler binaries and libraries with transitive dependencies, as well as by running the compiler and tests. Kotlin/Native can use the <a href="https://gradle.org" id="xwv5fd_13" data-external="true" rel="noopener noreferrer" target="_blank">Gradle</a> build system through the <a href="gradle-configure-project.html#targeting-multiple-platforms" id="xwv5fd_14" data-tooltip="Projects targeting multiple platforms, called multiplatform projects, require the kotlin-multiplatform plugin.">Kotlin Multiplatform plugin</a>.</p><section class="chapter"><h2 id="before-you-start" data-toc="before-you-start">Before you start</h2><ol class="list _decimal" id="xwv5fd_15" type="1"><li class="list__item" id="xwv5fd_16"><p id="xwv5fd_20">Download and install the latest version of <a href="https://www.jetbrains.com/idea/" id="xwv5fd_21" data-external="true" rel="noopener noreferrer" target="_blank">IntelliJ IDEA</a>.</p></li><li class="list__item" id="xwv5fd_17"><p id="xwv5fd_22">Clone the <a href="https://github.com/Kotlin/kmp-native-wizard" id="xwv5fd_24" data-external="true" rel="noopener noreferrer" target="_blank">project template</a> by selecting <span class="control" id="xwv5fd_25">File</span> | <span class="control" id="xwv5fd_26">New</span> | <span class="control" id="xwv5fd_27">Project from Version Control</span> in IntelliJ IDEA and using this URL:</p><div class="code-block" data-lang="none">
https://github.com/Kotlin/kmp-native-wizard
</div></li><li class="list__item" id="xwv5fd_18"><p id="xwv5fd_28">Explore the project structure:</p><figure id="xwv5fd_29"><img alt="Native application project structure" src="images/native-project-structure.png" title="Native application project structure" width="700" height="436"></figure><p id="xwv5fd_30">The template includes a project with the files and folders you need to get started. It's important to understand that an application written in Kotlin/Native can target different platforms if the code does not have platform-specific requirements. Your code is placed in the <code class="code" id="xwv5fd_31">nativeMain</code> directory with a corresponding <code class="code" id="xwv5fd_32">nativeTest</code>. For this tutorial, keep the folder structure as is.</p></li><li class="list__item" id="xwv5fd_19"><p id="xwv5fd_33">Open the <code class="code" id="xwv5fd_36">build.gradle.kts</code> file, the build script that contains the project settings. Pay special attention to the following in the build file:</p><div class="code-block" data-lang="kotlin">
kotlin {
    val hostOs = System.getProperty(&quot;os.name&quot;)
    val isArm64 = System.getProperty(&quot;os.arch&quot;) == &quot;aarch64&quot;
    val isMingwX64 = hostOs.startsWith(&quot;Windows&quot;)
    val nativeTarget = when {
        hostOs == &quot;Mac OS X&quot; &amp;&amp; isArm64 -&gt; macosArm64(&quot;native&quot;)
        hostOs == &quot;Mac OS X&quot; &amp;&amp; !isArm64 -&gt; macosX64(&quot;native&quot;)
        hostOs == &quot;Linux&quot; &amp;&amp; isArm64 -&gt; linuxArm64(&quot;native&quot;)
        hostOs == &quot;Linux&quot; &amp;&amp; !isArm64 -&gt; linuxX64(&quot;native&quot;)
        isMingwX64 -&gt; mingwX64(&quot;native&quot;)
        else -&gt; throw GradleException(&quot;Host OS is not supported in Kotlin/Native.&quot;)
    }

    nativeTarget.apply {
        binaries {
            executable {
                entryPoint = &quot;main&quot;
            }
        }
    }
}

</div><ul class="list _bullet" id="xwv5fd_35"><li class="list__item" id="xwv5fd_37"><p id="xwv5fd_40">Targets are defined using <code class="code" id="xwv5fd_41">macosArm64</code>, <code class="code" id="xwv5fd_42">macosX64</code>, <code class="code" id="xwv5fd_43">linuxArm64</code>, <code class="code" id="xwv5fd_44">linuxX64</code>, and <code class="code" id="xwv5fd_45">mingwX64</code> for macOS, Linux, and Windows. See the complete list of <a href="native-target-support.html" id="xwv5fd_46" data-tooltip="The Kotlin/Native compiler supports a great number of different targets, though it is hard to provide the same level of support for all of them. This document describes which targets Kotlin/Native supports and breaks them into several tiers depending on how well the compiler…">supported platforms</a>.</p></li><li class="list__item" id="xwv5fd_38"><p id="xwv5fd_47">The entry itself defines a series of properties to indicate how the binary is generated and the entry point of the applications. These can be left as default values.</p></li><li class="list__item" id="xwv5fd_39"><p id="xwv5fd_48">C interoperability is configured as an additional step in the build. By default, all the symbols from C are imported to the <code class="code" id="xwv5fd_49">interop</code> package. You may want to import the whole package in <code class="code" id="xwv5fd_50">.kt</code> files. Learn more about <a href="gradle-configure-project.html#targeting-multiple-platforms" id="xwv5fd_51" data-tooltip="Projects targeting multiple platforms, called multiplatform projects, require the kotlin-multiplatform plugin.">how to configure</a> it.</p></li></ul></li></ol></section><section class="chapter"><h2 id="create-a-definition-file" data-toc="create-a-definition-file">Create a definition file</h2><p id="xwv5fd_52">When writing native applications, you often need access to certain functionalities that are not included in the <a href="https://kotlinlang.org/api/latest/jvm/stdlib/" id="xwv5fd_59" data-external="true" rel="noopener noreferrer" target="_blank">Kotlin standard library</a>, such as making HTTP requests, reading and writing from disk, and so on.</p><p id="xwv5fd_53">Kotlin/Native helps consume standard C libraries, opening up an entire ecosystem of functionality that exists for pretty much anything you may need. Kotlin/Native is already shipped with a set of prebuilt <a href="native-platform-libs.html" id="xwv5fd_60" data-tooltip="To provide access to native services of operating systems, the Kotlin/Native distribution includes a set of prebuilt libraries specific to each target. These are called platform libraries.">platform libraries</a>, which provide some additional common functionality to the standard library.</p><p id="xwv5fd_54">An ideal scenario for interop is to call C functions as if you are calling Kotlin functions, following the same signature and conventions. This is when the cinterop tool comes in handy. It takes a C library and generates the corresponding Kotlin bindings, so that the library can be used as if it were Kotlin code.</p><p id="xwv5fd_55">To generate these bindings, each library needs a definition file, usually with the same name as the library. This is a property file that describes exactly how the library should be consumed.</p><p id="xwv5fd_56">In this app, you'll need the libcurl library to make some HTTP calls. To create its definition file:</p><ol class="list _decimal" id="xwv5fd_57" type="1"><li class="list__item" id="xwv5fd_61"><p id="xwv5fd_65">Select the <code class="code" id="xwv5fd_66">src</code> folder and create a new directory with <span class="control" id="xwv5fd_67">File | New | Directory</span>.</p></li><li class="list__item" id="xwv5fd_62"><p id="xwv5fd_68">Name the new directory <span class="control" id="xwv5fd_69">nativeInterop/cinterop</span>. This is the default convention for header file locations, though it can be overridden in the <code class="code" id="xwv5fd_70">build.gradle.kts</code> file if you use a different location.</p></li><li class="list__item" id="xwv5fd_63"><p id="xwv5fd_71">Select this new subfolder and create a new <code class="code" id="xwv5fd_72">libcurl.def</code> file with <span class="control" id="xwv5fd_73">File | New | File</span>.</p></li><li class="list__item" id="xwv5fd_64"><p id="xwv5fd_74">Update your file with the following code:</p><div class="code-block" data-lang="c">
headers = curl/curl.h
headerFilter = curl/*

compilerOpts.linux = -I/usr/include -I/usr/include/x86_64-linux-gnu
linkerOpts.osx = -L/opt/local/lib -L/usr/local/opt/curl/lib -lcurl
linkerOpts.linux = -L/usr/lib/x86_64-linux-gnu -lcurl
</div><ul class="list _bullet" id="xwv5fd_76"><li class="list__item" id="xwv5fd_78"><p id="xwv5fd_81"><code class="code" id="xwv5fd_82">headers</code> is the list of header files to generate Kotlin stubs for. You can add multiple files to this entry, separating each with a space. In this case, it's only <code class="code" id="xwv5fd_83">curl.h</code>. The referenced files need to be available on the specified path (in this case, it's <code class="code" id="xwv5fd_84">/usr/include/curl</code>).</p></li><li class="list__item" id="xwv5fd_79"><p id="xwv5fd_85"><code class="code" id="xwv5fd_87">headerFilter</code> shows what exactly is included. In C, all the headers are also included when one file references another one with the <code class="code" id="xwv5fd_88">#include</code> directive. Sometimes it's not necessary, and you can add this parameter <a href="https://en.wikipedia.org/wiki/Glob_(programming)" id="xwv5fd_89" data-external="true" rel="noopener noreferrer" target="_blank">using glob patterns</a> to make adjustments.</p><p id="xwv5fd_86">You can use <code class="code" id="xwv5fd_90">headerFilter</code> if you don't want to fetch external dependencies (such as system <code class="code" id="xwv5fd_91">stdint.h</code> header) into the interop library. Also, it may be useful for library size optimization and fixing potential conflicts between the system and the provided Kotlin/Native compilation environment.</p></li><li class="list__item" id="xwv5fd_80"><p id="xwv5fd_92">If the behavior for a certain platform needs to be modified, you can use a format like <code class="code" id="xwv5fd_93">compilerOpts.osx</code> or <code class="code" id="xwv5fd_94">compilerOpts.linux</code> to provide platform-specific values to the options. In this case, they are macOS (the <code class="code" id="xwv5fd_95">.osx</code> suffix) and Linux (the <code class="code" id="xwv5fd_96">.linux</code> suffix). Parameters without a suffix are also possible (for example, <code class="code" id="xwv5fd_97">linkerOpts=</code>) and applied to all platforms.</p></li></ul><p id="xwv5fd_77">For the full list of available options, see <a href="native-definition-file.html#properties" id="xwv5fd_98" data-tooltip="Here's the full list of properties you can use in your definition file to adjust the content of the generated binaries. For more information, see the corresponding sections below.">Definition file</a>.</p></li></ol><aside class="prompt" data-type="note" data-title="" id="xwv5fd_58"><p id="xwv5fd_99">You need to have the <code class="code" id="xwv5fd_100">curl</code> library binaries on your system to make the sample work. On macOS and Linux, they are usually included. On Windows, you can build it from <a href="https://curl.se/download.html" id="xwv5fd_101" data-external="true" rel="noopener noreferrer" target="_blank">sources</a> (you'll need Microsoft Visual Studio or Windows SDK command-line tools). For more details, see the <a href="https://jonnyzzz.com/blog/2018/10/29/kn-libcurl-windows/" id="xwv5fd_102" data-external="true" rel="noopener noreferrer" target="_blank">related blog post</a>. Alternatively, you may want to consider a <a href="https://www.msys2.org/" id="xwv5fd_103" data-external="true" rel="noopener noreferrer" target="_blank">MinGW/MSYS2</a> <code class="code" id="xwv5fd_104">curl</code> binary.</p></aside></section><section class="chapter"><h2 id="add-interoperability-to-the-build-process" data-toc="add-interoperability-to-the-build-process">Add interoperability to the build process</h2><p id="xwv5fd_105">To use header files, make sure they are generated as a part of the build process. For this, add the following entry to the <code class="code" id="xwv5fd_109">build.gradle.kts</code> file:</p><div class="code-block" data-lang="kotlin">
nativeTarget.apply {
    compilations.getByName(&quot;main&quot;) {
        cinterops {
            val libcurl by creating
        }
    }
    binaries {
        executable {
            entryPoint = &quot;main&quot;
        }
    }
}
</div><p id="xwv5fd_107">First, <code class="code" id="xwv5fd_110">cinterops</code> is added, and then an entry for a definition file. By default, the name of the file is used. You can override this with additional parameters:</p><div class="code-block" data-lang="kotlin">
cinterops {
    val libcurl by creating {
        definitionFile.set(project.file(&quot;src/nativeInterop/cinterop/libcurl.def&quot;))
        packageName(&quot;com.jetbrains.handson.http&quot;)
        compilerOpts(&quot;-I/path&quot;)
        includeDirs.allHeaders(&quot;path&quot;)
    }
}
</div></section><section class="chapter"><h2 id="write-the-application-code" data-toc="write-the-application-code">Write the application code</h2><p id="xwv5fd_111">Now that you have the library and the corresponding Kotlin stubs, you can use them from your application. For this tutorial, convert the <a href="https://curl.se/libcurl/c/simple.html" id="xwv5fd_116" data-external="true" rel="noopener noreferrer" target="_blank">simple.c</a> example to Kotlin.</p><p id="xwv5fd_112">In the <code class="code" id="xwv5fd_117">src/nativeMain/kotlin/</code> folder, update your <code class="code" id="xwv5fd_118">Main.kt</code> file with the following code:</p><div class="code-block" data-lang="kotlin">
import kotlinx.cinterop.*
import libcurl.*

@OptIn(ExperimentalForeignApi::class)
fun main(args: Array&lt;String&gt;) {
    val curl = curl_easy_init()
    if (curl != null) {
        curl_easy_setopt(curl, CURLOPT_URL, &quot;https://example.com&quot;)
        curl_easy_setopt(curl, CURLOPT_FOLLOWLOCATION, 1L)
        val res = curl_easy_perform(curl)
        if (res != CURLE_OK) {
            println(&quot;curl_easy_perform() failed ${curl_easy_strerror(res)?.toKString()}&quot;)
        }
        curl_easy_cleanup(curl)
    }
}
</div><p id="xwv5fd_114">As you can see, explicit variable declarations are eliminated in the Kotlin version, but everything else is pretty much the same as the C version. All the calls you'd expect in the libcurl library are available in the Kotlin equivalent.</p><aside class="prompt" data-type="tip" data-title="" id="xwv5fd_115"><p id="xwv5fd_119">This is a line-by-line literal translation. You could also write this in a more Kotlin idiomatic way.</p></aside></section><section class="chapter"><h2 id="compile-and-run-the-application" data-toc="compile-and-run-the-application">Compile and run the application</h2><ol class="list _decimal" id="xwv5fd_120" type="1"><li class="list__item" id="xwv5fd_123"><p id="xwv5fd_125">Compile the application. To do that, run the <code class="code" id="xwv5fd_128">runDebugExecutableNative</code> Gradle task from the task list or use the following command in the terminal:</p><div class="code-block" data-lang="bash">
./gradlew runDebugExecutableNative
</div><p id="xwv5fd_127">In this case, the part generated by the cinterop tool is implicitly included in the build.</p></li><li class="list__item" id="xwv5fd_124"><p id="xwv5fd_129">If there are no errors during compilation, click the green <span class="control" id="xwv5fd_132">Run</span> icon in the gutter next to the <code class="code" id="xwv5fd_133">main()</code> function or use the <kbd class="keystroke" id="xwv5fd_134" data-bypass="true"><span class="keystroke__value">Shift + Cmd + R</span></kbd>/<kbd class="keystroke" id="xwv5fd_135" data-bypass="true"><span class="keystroke__value">Shift + F10</span></kbd> shortcut.</p><p id="xwv5fd_130">IntelliJ IDEA opens the <span class="control" id="xwv5fd_136">Run</span> tab and shows the output &mdash; the contents of <a href="https://example.com/" id="xwv5fd_137" data-external="true" rel="noopener noreferrer" target="_blank">example.com</a>:</p><figure id="xwv5fd_131"><img alt="Application output with HTML-code" src="images/native-output.png" title="Application output with HTML-code" width="700" height="672"></figure></li></ol><p id="xwv5fd_121">You can see the actual output because the call <code class="code" id="xwv5fd_138">curl_easy_perform</code> prints the result to the standard output. You could hide this using <code class="code" id="xwv5fd_139">curl_easy_setopt</code>.</p><aside class="prompt" data-type="note" data-title="" id="xwv5fd_122"><p id="xwv5fd_140">You can get the full project code in our <a href="https://github.com/Kotlin/kotlin-hands-on-intro-kotlin-native" id="xwv5fd_141" data-external="true" rel="noopener noreferrer" target="_blank">GitHub repository</a>.</p></aside></section><section class="chapter"><h2 id="what-s-next" data-toc="what-s-next">What's next</h2><p id="xwv5fd_142">Learn more about <a href="native-c-interop.html" id="xwv5fd_143" data-tooltip="The C libraries import is Experimental. All Kotlin declarations generated by the cinterop tool from C libraries should have the @ExperimentalForeignApi annotation.">Kotlin's interoperability with C</a>.</p></section><div class="last-modified">21 April 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="native-dynamic-libraries.html" class="navigation-links__prev">Kotlin/Native as a dynamic library &ndash; tutorial</a><a href="native-objc-interop.html" class="navigation-links__next">Interoperability with Swift/Objective-C</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="frontend/app.js"></script></body></html>