<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-04-23T13:00:00.774233373"><title>Android source set layout | Kotlin</title><script type="application/json" id="virtual-toc-data">[{"id":"check-the-compatibility","level":0,"title":"Check the compatibility","anchor":"#check-the-compatibility"},{"id":"rename-kotlin-source-sets","level":0,"title":"Rename Kotlin source sets","anchor":"#rename-kotlin-source-sets"},{"id":"move-source-files","level":0,"title":"Move source files","anchor":"#move-source-files"},{"id":"move-the-androidmanifest-xml-file","level":0,"title":"Move the AndroidManifest.xml file","anchor":"#move-the-androidmanifest-xml-file"},{"id":"check-the-relationship-between-android-and-common-tests","level":0,"title":"Check the relationship between Android and common tests","anchor":"#check-the-relationship-between-android-and-common-tests"},{"id":"adjust-the-implementation-of-android-flavors","level":0,"title":"Adjust the implementation of Android flavors","anchor":"#adjust-the-implementation-of-android-flavors"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="frontend/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="icon" type="image/png" sizes="32x32" href="writerside_32.png"><link rel="icon" type="image/png" sizes="64x64" href="writerside_64.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Android source set layout | Kotlin"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Kotlin Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/multiplatform-android-layout.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Android source set layout | Kotlin"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/multiplatform-android-layout.html#webpage",
    "url": "writerside-documentation/multiplatform-android-layout.html",
    "name": "Android source set layout | Kotlin",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Kotlin Help"
}</script><!-- End Schema.org --></head><body data-id="multiplatform-android-layout" data-main-title="Android source set layout" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="Multiplatform development///Reference"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Kotlin  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="multiplatform-android-layout" id="multiplatform-android-layout.md">Android source set layout</h1><p id="yq4k58_2">The new Android source set layout was introduced in Kotlin 1.8.0 and became the default in 1.9.0. Follow this guide to understand the key differences between the deprecated and the new layouts, as well as how to migrate your projects.</p><aside class="prompt" data-type="tip" data-title="" id="yq4k58_3"><p id="yq4k58_10">You don't need to implement all the suggestions, only those that are applicable to your particular projects.</p></aside><section class="chapter"><h2 id="check-the-compatibility" data-toc="check-the-compatibility">Check the compatibility</h2><p id="yq4k58_11">The new layout requires Android Gradle plugin 7.0 or later and is supported in Android Studio 2022.3 and later. Check your version of the Android Gradle plugin and upgrade if necessary.</p></section><section class="chapter"><h2 id="rename-kotlin-source-sets" data-toc="rename-kotlin-source-sets">Rename Kotlin source sets</h2><p id="yq4k58_12">If applicable, rename the source sets in your project, following this pattern:</p><div class="table-wrapper"><table class="wide" id="yq4k58_13"><thead><tr class="ijRowHead" id="yq4k58_16"><th id="yq4k58_18"><p>Previous source set layout</p></th><th id="yq4k58_19"><p>New source set layout</p></th></tr></thead><tbody><tr id="yq4k58_17"><td id="yq4k58_20"><p><code class="code" id="yq4k58_22">targetName</code> + <code class="code" id="yq4k58_23">AndroidSourceSet.name</code></p></td><td id="yq4k58_21"><p><code class="code" id="yq4k58_24">targetName</code> + <code class="code" id="yq4k58_25">AndroidVariantType</code></p></td></tr></tbody></table></div><p id="yq4k58_14"><code class="code" id="yq4k58_26">{AndroidSourceSet.name}</code> maps to <code class="code" id="yq4k58_27">{KotlinSourceSet.name}</code> as follows:</p><div class="table-wrapper"><table class="wide" id="yq4k58_15"><thead><tr class="ijRowHead" id="yq4k58_28"><th id="yq4k58_32"></th><th id="yq4k58_33"><p>Previous source set layout</p></th><th id="yq4k58_34"><p>New source set layout</p></th></tr></thead><tbody><tr id="yq4k58_29"><td id="yq4k58_35"><p>main</p></td><td id="yq4k58_36"><p>androidMain</p></td><td id="yq4k58_37"><p>androidMain</p></td></tr><tr id="yq4k58_30"><td id="yq4k58_38"><p>test</p></td><td id="yq4k58_39"><p>androidTest</p></td><td id="yq4k58_40"><p>android<b id="yq4k58_41">Unit</b>Test</p></td></tr><tr id="yq4k58_31"><td id="yq4k58_42"><p>androidTest</p></td><td id="yq4k58_43"><p>android<b id="yq4k58_45">Android</b>Test</p></td><td id="yq4k58_44"><p>android<b id="yq4k58_46">Instrumented</b>Test</p></td></tr></tbody></table></div></section><section class="chapter"><h2 id="move-source-files" data-toc="move-source-files">Move source files</h2><p id="yq4k58_47">If applicable, move your source files to the new directories, following this pattern:</p><div class="table-wrapper"><table class="wide" id="yq4k58_48"><thead><tr class="ijRowHead" id="yq4k58_51"><th id="yq4k58_53"><p>Previous source set layout</p></th><th id="yq4k58_54"><p>New source set layout</p></th></tr></thead><tbody><tr id="yq4k58_52"><td id="yq4k58_55"><p>The layout had additional <code class="code" id="yq4k58_57">/kotlin</code> SourceDirectories</p></td><td id="yq4k58_56"><p><code class="code" id="yq4k58_58">src/{KotlinSourceSet.name}/kotlin</code></p></td></tr></tbody></table></div><p id="yq4k58_49"><code class="code" id="yq4k58_59">{AndroidSourceSet.name}</code> maps to <code class="code" id="yq4k58_60">{SourceDirectories included}</code> as follows:</p><div class="table-wrapper"><table class="wide" id="yq4k58_50"><thead><tr class="ijRowHead" id="yq4k58_61"><th id="yq4k58_65"></th><th id="yq4k58_66"><p>Previous source set layout</p></th><th id="yq4k58_67"><p>New source set layout</p></th></tr></thead><tbody><tr id="yq4k58_62"><td id="yq4k58_68"><p>main</p></td><td id="yq4k58_69"><p>src/androidMain/kotlin<br> src/main/kotlin<br> src/main/java</p></td><td id="yq4k58_70"><p>src/androidMain/kotlin<br> src/main/kotlin<br> src/main/java</p></td></tr><tr id="yq4k58_63"><td id="yq4k58_75"><p>test</p></td><td id="yq4k58_76"><p>src/androidTest/kotlin<br> src/test/kotlin<br> src/test/java</p></td><td id="yq4k58_77"><p>src/android<b id="yq4k58_80">Unit</b>Test/kotlin<br> src/test/kotlin<br> src/test/java</p></td></tr><tr id="yq4k58_64"><td id="yq4k58_83"><p>androidTest</p></td><td id="yq4k58_84"><p>src/android<b id="yq4k58_86">Android</b>Test/kotlin<br> src/androidTest/java</p></td><td id="yq4k58_85"><p>src/android<b id="yq4k58_88">Instrumented</b>Test/kotlin<br> src/androidTest/java, <b id="yq4k58_90">src/androidTest/kotlin</b></p></td></tr></tbody></table></div></section><section class="chapter"><h2 id="move-the-androidmanifest-xml-file" data-toc="move-the-androidmanifest-xml-file">Move the AndroidManifest.xml file</h2><p id="yq4k58_91">If you have the <code class="code" id="yq4k58_95">AndroidManifest.xml</code> file in your project, move it to the new directory, following this pattern:</p><div class="table-wrapper"><table class="wide" id="yq4k58_92"><thead><tr class="ijRowHead" id="yq4k58_96"><th id="yq4k58_98"><p>Previous source set layout</p></th><th id="yq4k58_99"><p>New source set layout</p></th></tr></thead><tbody><tr id="yq4k58_97"><td id="yq4k58_100"><p>src/{<b id="yq4k58_102">Android</b>SourceSet.name}/AndroidManifest.xml</p></td><td id="yq4k58_101"><p>src/{<b id="yq4k58_103">Kotlin</b>SourceSet.name}/AndroidManifest.xml</p></td></tr></tbody></table></div><p id="yq4k58_93"><code class="code" id="yq4k58_104">{AndroidSourceSet.name}</code> maps to <code class="code" id="yq4k58_105">{AndroidManifest.xml location}</code> as follows:</p><div class="table-wrapper"><table class="wide" id="yq4k58_94"><thead><tr class="ijRowHead" id="yq4k58_106"><th id="yq4k58_109"></th><th id="yq4k58_110"><p>Previous source set layout</p></th><th id="yq4k58_111"><p>New source set layout</p></th></tr></thead><tbody><tr id="yq4k58_107"><td id="yq4k58_112"><p>main</p></td><td id="yq4k58_113"><p>src/main/AndroidManifest.xml</p></td><td id="yq4k58_114"><p>src/<b id="yq4k58_115">android</b>Main/AndroidManifest.xml</p></td></tr><tr id="yq4k58_108"><td id="yq4k58_116"><p>debug</p></td><td id="yq4k58_117"><p>src/debug/AndroidManifest.xml</p></td><td id="yq4k58_118"><p>src/<b id="yq4k58_119">android</b>Debug/AndroidManifest.xml</p></td></tr></tbody></table></div></section><section class="chapter"><h2 id="check-the-relationship-between-android-and-common-tests" data-toc="check-the-relationship-between-android-and-common-tests">Check the relationship between Android and common tests</h2><p id="yq4k58_120">The new Android source set layout changes the relationship between Android-instrumented tests (renamed to <code class="code" id="yq4k58_125">androidInstrumentedTest</code> in the new layout) and common tests.</p><p id="yq4k58_121">Previously, the <code class="code" id="yq4k58_126">dependsOn</code> relationship between <code class="code" id="yq4k58_127">androidAndroidTest</code> and <code class="code" id="yq4k58_128">commonTest</code> was the default. It meant the following:</p><ul class="list _bullet" id="yq4k58_122"><li class="list__item" id="yq4k58_129"><p id="yq4k58_132">The code in <code class="code" id="yq4k58_133">commonTest</code> was available in <code class="code" id="yq4k58_134">androidAndroidTest</code>.</p></li><li class="list__item" id="yq4k58_130"><p id="yq4k58_135"><code class="code" id="yq4k58_136">expect</code> declarations in <code class="code" id="yq4k58_137">commonTest</code> had to have corresponding <code class="code" id="yq4k58_138">actual</code> implementations in <code class="code" id="yq4k58_139">androidAndroidTest</code>.</p></li><li class="list__item" id="yq4k58_131"><p id="yq4k58_140">Tests declared in <code class="code" id="yq4k58_141">commonTest</code> were also running as Android instrumented tests.</p></li></ul><p id="yq4k58_123">In the new Android source set layout, the <code class="code" id="yq4k58_142">dependsOn</code> relationship is not added by default. If you prefer the previous behavior, manually declare the following relationship in your <code class="code" id="yq4k58_143">build.gradle.kts</code> file:</p><div class="code-block" data-lang="kotlin">
kotlin {
// ...
    sourceSets {
        val commonTest by getting
        val androidInstrumentedTest by getting {
            dependsOn(commonTest)
        }
    }
}
</div></section><section class="chapter"><h2 id="adjust-the-implementation-of-android-flavors" data-toc="adjust-the-implementation-of-android-flavors">Adjust the implementation of Android flavors</h2><p id="yq4k58_144">Previously, the Kotlin Gradle plugin eagerly created source sets that corresponded to Android source sets containing <code class="code" id="yq4k58_148">debug</code> and <code class="code" id="yq4k58_149">release</code> build types or custom flavors like <code class="code" id="yq4k58_150">demo</code> and <code class="code" id="yq4k58_151">full</code>. It made the source sets accessible by using expressions like <code class="code" id="yq4k58_152">val androidDebug by getting { ... }</code>.</p><p id="yq4k58_145">The new Android source set layout makes use of Android's <a href="https://developer.android.com/reference/tools/gradle-api/8.0/com/android/build/api/variant/AndroidComponentsExtension#onVariants(com.android.build.api.variant.VariantSelector,kotlin.Function1)" id="yq4k58_153" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="yq4k58_155">onVariants</code></a> to create source sets. It makes such expressions invalid, leading to errors like <code class="code" id="yq4k58_154">org.gradle.api.UnknownDomainObjectException: KotlinSourceSet with name 'androidDebug' not found</code>.</p><p id="yq4k58_146">To work around that, use the new <code class="code" id="yq4k58_156">invokeWhenCreated()</code> API in your <code class="code" id="yq4k58_157">build.gradle.kts</code> file:</p><div class="code-block" data-lang="kotlin">
kotlin {
// ...
    @OptIn(ExperimentalKotlinGradlePluginApi::class)
    sourceSets.invokeWhenCreated(&quot;androidFreeDebug&quot;) {
// ...
    }
}
</div></section><div class="last-modified">21 April 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="multiplatform-dsl-reference.html" class="navigation-links__prev">Multiplatform Gradle DSL reference</a><a href="multiplatform-compatibility-guide.html" class="navigation-links__next">Compatibility guide for Kotlin Multiplatform</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="frontend/app.js"></script></body></html>