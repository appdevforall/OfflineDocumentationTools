<html>
 <head>
  <meta charset="utf-8"/>
  <title>
   Kotlin Documentation
  </title>
  <link href="style.css" rel="stylesheet"/>
 </head>
 <body>
  <div style="text-align: center; margin-bottom: 1em;">
   <a href="toc.html" style="font-size: 24px; text-decoration: none;">
    Menu
   </a>
  </div>
  <article class="article" data-shortcut-switcher="inactive">
   <h1 data-toc="native-dynamic-libraries" id="native-dynamic-libraries.md">
    Kotlin/Native as a dynamic library â€“ tutorial
   </h1>
   <p id="-osq5v3_2">
    You can create dynamic libraries to use Kotlin code from existing programs. This enables code sharing across many platforms or languages, including JVM, Python, Android, and others.
   </p>
   <aside class="prompt" data-title="" data-type="tip" id="-osq5v3_3">
    <p id="-osq5v3_15">
     For iOS and other Apple targets, we recommend generating a framework. See the
     <a data-tooltip="The Objective-C libraries import is Experimental. All Kotlin declarations generated by the cinterop tool from Objective-C libraries should have the @ExperimentalForeignApi annotation." href="apple-framework.html" id="-osq5v3_16" style="color: blue;">
      Kotlin/Native as an Apple framework
     </a>
     tutorial.
    </p>
   </aside>
   <p id="-osq5v3_4">
    You can use the Kotlin/Native code from existing native applications or libraries. For this, you need to compile the Kotlin code into a dynamic library in the
    <code class="code" id="-osq5v3_17">
     .so
    </code>
    ,
    <code class="code" id="-osq5v3_18">
     .dylib
    </code>
    , or
    <code class="code" id="-osq5v3_19">
     .dll
    </code>
    format.
   </p>
   <p id="-osq5v3_5">
    In this tutorial, you will:
   </p>
   <ul class="list _bullet" id="-osq5v3_6">
    <li class="list__item" id="-osq5v3_20">
     <p id="-osq5v3_24">
      <a data-tooltip="The Kotlin/Native compiler can produce a dynamic library from the Kotlin code. A dynamic library often comes with a .h header file, which you use to call the compiled code from C." href="#create-a-kotlin-library" id="-osq5v3_25" style="color: blue;">
       Compile Kotlin code to a dynamic library
      </a>
     </p>
    </li>
    <li class="list__item" id="-osq5v3_21">
     <p id="-osq5v3_26">
      <a data-tooltip="Let's examine how Kotlin/Native declarations are mapped to C functions." href="#generated-header-file" id="-osq5v3_27" style="color: blue;">
       Examine generated C headers
      </a>
     </p>
    </li>
    <li class="list__item" id="-osq5v3_22">
     <p id="-osq5v3_28">
      <a data-tooltip="Using the generated headers from C is straightforward. In the library directory, create the main.c file with the following code:" href="#use-generated-headers-from-c" id="-osq5v3_29" style="color: blue;">
       Use the Kotlin dynamic library from C
      </a>
     </p>
    </li>
    <li class="list__item" id="-osq5v3_23">
     <p id="-osq5v3_30">
      <a data-tooltip="To compile the C code and link it with the dynamic library, navigate to the library directory and run the following command:" href="#compile-and-run-the-project" id="-osq5v3_31" style="color: blue;">
       Compile and run the project
      </a>
     </p>
    </li>
   </ul>
   <p id="-osq5v3_7">
    You can use the command line to generate a Kotlin library, either directly or with a script file (such as
    <code class="code" id="-osq5v3_32">
     .sh
    </code>
    or
    <code class="code" id="-osq5v3_33">
     .bat
    </code>
    file). However, this approach doesn't scale well for larger projects that have hundreds of files and libraries. Using a build system simplifies the process by downloading and caching the Kotlin/Native compiler binaries and libraries with transitive dependencies, as well as by running the compiler and tests. Kotlin/Native can use the
    <a data-external="true" href="https://gradle.org" id="-osq5v3_34" rel="noopener noreferrer" style="color: red;" target="_blank">
     Gradle
    </a>
    build system through the
    <a data-tooltip="Projects targeting multiple platforms, called multiplatform projects, require the kotlin-multiplatform plugin." href="gradle-configure-project.html#targeting-multiple-platforms" id="-osq5v3_35" style="color: blue;">
     Kotlin Multiplatform plugin
    </a>
    .
   </p>
   <p id="-osq5v3_8">
    Let's examine the advanced C interop-related usages of Kotlin/Native and
    <a data-tooltip="Projects targeting multiple platforms, called multiplatform projects, require the kotlin-multiplatform plugin." href="gradle-configure-project.html#targeting-multiple-platforms" id="-osq5v3_36" style="color: blue;">
     Kotlin Multiplatform
    </a>
    builds with Gradle.
   </p>
   <aside class="prompt" data-title="" data-type="note" id="-osq5v3_9">
    <p id="-osq5v3_37">
     If you use a Mac and want to create and run applications for macOS or other Apple targets, you also need to install the
     <a data-external="true" href="https://developer.apple.com/download/" id="-osq5v3_38" rel="noopener noreferrer" style="color: red;" target="_blank">
      Xcode Command Line Tools
     </a>
     , launch it, and accept the license terms first.
    </p>
   </aside>
   <section class="chapter">
    <h2 data-toc="create-a-kotlin-library" id="create-a-kotlin-library">
     Create a Kotlin library
    </h2>
    <p id="-osq5v3_39">
     The Kotlin/Native compiler can produce a dynamic library from the Kotlin code. A dynamic library often comes with a
     <code class="code" id="-osq5v3_47">
      .h
     </code>
     header file, which you use to call the compiled code from C.
    </p>
    <p id="-osq5v3_40">
     Let's create a Kotlin library and use it from a C program.
    </p>
    <aside class="prompt" data-title="" data-type="tip" id="-osq5v3_41">
     <p id="-osq5v3_48">
      See the
      <a data-tooltip="In this section, you'll learn how to manually create a Kotlin/Native application using Gradle. It's the default build system for Kotlin/Native and Kotlin Multiplatform projects, which is also commonly used in Java, Android, and other ecosystems." href="native-get-started.html#using-gradle" id="-osq5v3_49" style="color: blue;">
       Get started with Kotlin/Native
      </a>
      tutorial for detailed first steps and instructions on how to create a new Kotlin/Native project and open it in IntelliJ IDEA.
     </p>
    </aside>
    <ol class="list _decimal" id="-osq5v3_42" type="1">
     <li class="list__item" id="-osq5v3_50">
      <p id="-osq5v3_53">
       Navigate to the
       <code class="code" id="-osq5v3_55">
        src/nativeMain/kotlin
       </code>
       directory and create the
       <code class="code" id="-osq5v3_56">
        lib.kt
       </code>
       file with the following library contents:
      </p>
      <div class="code-block" data-lang="kotlin" style="font-family: monospace; background: #f4f4f4; padding: 10px; overflow-x: auto; margin: 1em 0; display: block;">
       package example

object Object { 
    val field = "A"
}

class Clazz {
    fun memberFunction(p: Int): ULong = 42UL
}

fun forIntegers(b: Byte, s: Short, i: UInt, l: Long) { }
fun forFloats(f: Float, d: Double) { }

fun strings(str: String) : String? {
    return "That is '$str' from C"
}

val globalString = "A global String"
      </div>
     </li>
     <li class="list__item" id="-osq5v3_51">
      <p id="-osq5v3_57">
       Update your
       <code class="code" id="-osq5v3_60">
        build.gradle(.kts)
       </code>
       Gradle build file with the following:
      </p>
      <div class="tabs" data-anchors="[-osq5v3_61,-osq5v3_62]" data-group="build-script" id="-osq5v3_58">
       <div class="tabs__content" data-gtm="tab" data-sync-tabs="kotlin" data-title="Kotlin" id="-osq5v3_61">
        <div class="code-block" data-lang="kotlin" data-title="Kotlin" style="font-family: monospace; background: #f4f4f4; padding: 10px; overflow-x: auto; margin: 1em 0; display: block;">
         plugins {
    kotlin("multiplatform") version "2.1.20"
}

repositories {
    mavenCentral()
}

kotlin {
    macosArm64("native") {    // macOS on Apple Silicon
    // macosX64("native") {   // macOS on x86_64 platforms
    // linuxArm64("native") { // Linux on ARM64 platforms
    // linuxX64("native") {   // Linux on x86_64 platforms
    // mingwX64("native") {   // Windows
        binaries {
            sharedLib {
                baseName = "native"       // macOS and Linux 
                // baseName = "libnative" // Windows
            }
        }
    }
}

tasks.wrapper {
    gradleVersion = "8.10"
    distributionType = Wrapper.DistributionType.ALL
}
        </div>
       </div>
       <div class="tabs__content" data-gtm="tab" data-sync-tabs="groovy" data-title="Groovy" id="-osq5v3_62">
        <div class="code-block" data-lang="groovy" data-title="Groovy" style="font-family: monospace; background: #f4f4f4; padding: 10px; overflow-x: auto; margin: 1em 0; display: block;">
         plugins {
    id 'org.jetbrains.kotlin.multiplatform' version '2.1.20'
}

repositories {
    mavenCentral()
}

kotlin {
    macosArm64("native") {    // Apple Silicon macOS
    // macosX64("native") {   // macOS on x86_64 platforms
    // linuxArm64("native") { // Linux on ARM64 platforms
    // linuxX64("native") {   // Linux on x86_64 platforms
    // mingwX64("native") {   // Windows
        binaries {
            sharedLib {
                baseName = "native"       // macOS and Linux 
                // baseName = "libnative" // Windows
            }
        }
    }
}

wrapper {
    gradleVersion = "8.10"
    distributionType = "ALL"
}
        </div>
       </div>
      </div>
      <ul class="list _bullet" id="-osq5v3_59">
       <li class="list__item" id="-osq5v3_65">
        <p id="-osq5v3_67">
         The
         <code class="code" id="-osq5v3_68">
          binaries {}
         </code>
         block configures the project to generate a dynamic or shared library.
        </p>
       </li>
       <li class="list__item" id="-osq5v3_66">
        <p id="-osq5v3_69">
         <code class="code" id="-osq5v3_70">
          libnative
         </code>
         is used as the library name, the prefix for the generated header file name. It also prefixes all declarations in the header file.
        </p>
       </li>
      </ul>
     </li>
     <li class="list__item" id="-osq5v3_52">
      <p id="-osq5v3_71">
       Run the
       <code class="code" id="-osq5v3_73">
        linkDebugSharedNative
       </code>
       Gradle task in the IDE or use the following console command in your terminal to build the library:
      </p>
      <div class="code-block" data-lang="bash" style="font-family: monospace; background: #f4f4f4; padding: 10px; overflow-x: auto; margin: 1em 0; display: block;">
       ./gradlew linkDebugSharedNative
      </div>
     </li>
    </ol>
    <p id="-osq5v3_43">
     The build generates the library into the
     <code class="code" id="-osq5v3_74">
      build/bin/native/debugShared
     </code>
     directory with the following files:
    </p>
    <ul class="list _bullet" id="-osq5v3_44">
     <li class="list__item" id="-osq5v3_75">
      <p id="-osq5v3_78">
       macOS
       <code class="code" id="-osq5v3_79">
        libnative_api.h
       </code>
       and
       <code class="code" id="-osq5v3_80">
        libnative.dylib
       </code>
      </p>
     </li>
     <li class="list__item" id="-osq5v3_76">
      <p id="-osq5v3_81">
       Linux:
       <code class="code" id="-osq5v3_82">
        libnative_api.h
       </code>
       and
       <code class="code" id="-osq5v3_83">
        libnative.so
       </code>
      </p>
     </li>
     <li class="list__item" id="-osq5v3_77">
      <p id="-osq5v3_84">
       Windows:
       <code class="code" id="-osq5v3_85">
        libnative_api.h
       </code>
       ,
       <code class="code" id="-osq5v3_86">
        libnative.def
       </code>
       , and
       <code class="code" id="-osq5v3_87">
        libnative.dll
       </code>
      </p>
     </li>
    </ul>
    <aside class="prompt" data-title="" data-type="tip" id="-osq5v3_45">
     <p id="-osq5v3_88">
      You can also use the
      <code class="code" id="-osq5v3_89">
       linkNative
      </code>
      Gradle task to generate both
      <code class="code" id="-osq5v3_90">
       debug
      </code>
      and
      <code class="code" id="-osq5v3_91">
       release
      </code>
      variants of the library.
     </p>
    </aside>
    <p id="-osq5v3_46">
     The Kotlin/Native compiler uses the same rules to generate the
     <code class="code" id="-osq5v3_92">
      .h
     </code>
     file for all platforms. Let's check out the C API of the Kotlin library.
    </p>
   </section>
   <section class="chapter">
    <h2 data-toc="generated-header-file" id="generated-header-file">
     Generated header file
    </h2>
    <p id="-osq5v3_93">
     Let's examine how Kotlin/Native declarations are mapped to C functions.
    </p>
    <p id="-osq5v3_94">
     In the
     <code class="code" id="-osq5v3_110">
      build/bin/native/debugShared
     </code>
     directory, open the
     <code class="code" id="-osq5v3_111">
      libnative_api.h
     </code>
     header file. The very first part contains the standard C/C++ header and footer:
    </p>
    <div class="code-block" data-lang="c" style="font-family: monospace; background: #f4f4f4; padding: 10px; overflow-x: auto; margin: 1em 0; display: block;">
     #ifndef KONAN_LIBNATIVE_H
#define KONAN_LIBNATIVE_H
#ifdef __cplusplus
extern "C" {
#endif

/// The rest of the generated code

#ifdef __cplusplus
}  /* extern "C" */
#endif
#endif  /* KONAN_LIBNATIVE_H */
    </div>
    <p id="-osq5v3_96">
     Following this, the
     <code class="code" id="-osq5v3_112">
      libnative_api.h
     </code>
     includes a block with the common type definitions:
    </p>
    <div class="code-block" data-lang="c" style="font-family: monospace; background: #f4f4f4; padding: 10px; overflow-x: auto; margin: 1em 0; display: block;">
     #ifdef __cplusplus
typedef bool            libnative_KBoolean;
#else
typedef _Bool           libnative_KBoolean;
#endif
typedef unsigned short     libnative_KChar;
typedef signed char        libnative_KByte;
typedef short              libnative_KShort;
typedef int                libnative_KInt;
typedef long long          libnative_KLong;
typedef unsigned char      libnative_KUByte;
typedef unsigned short     libnative_KUShort;
typedef unsigned int       libnative_KUInt;
typedef unsigned long long libnative_KULong;
typedef float              libnative_KFloat;
typedef double             libnative_KDouble;
typedef float __attribute__ ((__vector_size__ (16))) libnative_KVector128;
typedef void*              libnative_KNativePtr;
    </div>
    <p id="-osq5v3_98">
     Kotlin uses the
     <code class="code" id="-osq5v3_113">
      libnative_
     </code>
     prefix for all declarations in the created
     <code class="code" id="-osq5v3_114">
      libnative_api.h
     </code>
     file. Here's the complete list of type mappings:
    </p>
    <div class="table-wrapper">
     <table class="wide" id="-osq5v3_99">
      <thead>
       <tr class="ijRowHead" id="-osq5v3_115">
        <th id="-osq5v3_130">
         <p>
          Kotlin definition
         </p>
        </th>
        <th id="-osq5v3_131">
         <p>
          C type
         </p>
        </th>
       </tr>
      </thead>
      <tbody>
       <tr id="-osq5v3_116">
        <td id="-osq5v3_132">
         <p>
          <code class="code" id="-osq5v3_134">
           libnative_KBoolean
          </code>
         </p>
        </td>
        <td id="-osq5v3_133">
         <p>
          <code class="code" id="-osq5v3_135">
           bool
          </code>
          or
          <code class="code" id="-osq5v3_136">
           _Bool
          </code>
         </p>
        </td>
       </tr>
       <tr id="-osq5v3_117">
        <td id="-osq5v3_137">
         <p>
          <code class="code" id="-osq5v3_139">
           libnative_KChar
          </code>
         </p>
        </td>
        <td id="-osq5v3_138">
         <p>
          <code class="code" id="-osq5v3_140">
           unsigned short
          </code>
         </p>
        </td>
       </tr>
       <tr id="-osq5v3_118">
        <td id="-osq5v3_141">
         <p>
          <code class="code" id="-osq5v3_143">
           libnative_KByte
          </code>
         </p>
        </td>
        <td id="-osq5v3_142">
         <p>
          <code class="code" id="-osq5v3_144">
           signed char
          </code>
         </p>
        </td>
       </tr>
       <tr id="-osq5v3_119">
        <td id="-osq5v3_145">
         <p>
          <code class="code" id="-osq5v3_147">
           libnative_KShort
          </code>
         </p>
        </td>
        <td id="-osq5v3_146">
         <p>
          <code class="code" id="-osq5v3_148">
           short
          </code>
         </p>
        </td>
       </tr>
       <tr id="-osq5v3_120">
        <td id="-osq5v3_149">
         <p>
          <code class="code" id="-osq5v3_151">
           libnative_KInt
          </code>
         </p>
        </td>
        <td id="-osq5v3_150">
         <p>
          <code class="code" id="-osq5v3_152">
           int
          </code>
         </p>
        </td>
       </tr>
       <tr id="-osq5v3_121">
        <td id="-osq5v3_153">
         <p>
          <code class="code" id="-osq5v3_155">
           libnative_KLong
          </code>
         </p>
        </td>
        <td id="-osq5v3_154">
         <p>
          <code class="code" id="-osq5v3_156">
           long long
          </code>
         </p>
        </td>
       </tr>
       <tr id="-osq5v3_122">
        <td id="-osq5v3_157">
         <p>
          <code class="code" id="-osq5v3_159">
           libnative_KUByte
          </code>
         </p>
        </td>
        <td id="-osq5v3_158">
         <p>
          <code class="code" id="-osq5v3_160">
           unsigned char
          </code>
         </p>
        </td>
       </tr>
       <tr id="-osq5v3_123">
        <td id="-osq5v3_161">
         <p>
          <code class="code" id="-osq5v3_163">
           libnative_KUShort
          </code>
         </p>
        </td>
        <td id="-osq5v3_162">
         <p>
          <code class="code" id="-osq5v3_164">
           unsigned short
          </code>
         </p>
        </td>
       </tr>
       <tr id="-osq5v3_124">
        <td id="-osq5v3_165">
         <p>
          <code class="code" id="-osq5v3_167">
           libnative_KUInt
          </code>
         </p>
        </td>
        <td id="-osq5v3_166">
         <p>
          <code class="code" id="-osq5v3_168">
           unsigned int
          </code>
         </p>
        </td>
       </tr>
       <tr id="-osq5v3_125">
        <td id="-osq5v3_169">
         <p>
          <code class="code" id="-osq5v3_171">
           libnative_KULong
          </code>
         </p>
        </td>
        <td id="-osq5v3_170">
         <p>
          <code class="code" id="-osq5v3_172">
           unsigned long long
          </code>
         </p>
        </td>
       </tr>
       <tr id="-osq5v3_126">
        <td id="-osq5v3_173">
         <p>
          <code class="code" id="-osq5v3_175">
           libnative_KFloat
          </code>
         </p>
        </td>
        <td id="-osq5v3_174">
         <p>
          <code class="code" id="-osq5v3_176">
           float
          </code>
         </p>
        </td>
       </tr>
       <tr id="-osq5v3_127">
        <td id="-osq5v3_177">
         <p>
          <code class="code" id="-osq5v3_179">
           libnative_KDouble
          </code>
         </p>
        </td>
        <td id="-osq5v3_178">
         <p>
          <code class="code" id="-osq5v3_180">
           double
          </code>
         </p>
        </td>
       </tr>
       <tr id="-osq5v3_128">
        <td id="-osq5v3_181">
         <p>
          <code class="code" id="-osq5v3_183">
           libnative_KVector128
          </code>
         </p>
        </td>
        <td id="-osq5v3_182">
         <p>
          <code class="code" id="-osq5v3_184">
           float __attribute__ ((__vector_size__ (16))
          </code>
         </p>
        </td>
       </tr>
       <tr id="-osq5v3_129">
        <td id="-osq5v3_185">
         <p>
          <code class="code" id="-osq5v3_187">
           libnative_KNativePtr
          </code>
         </p>
        </td>
        <td id="-osq5v3_186">
         <p>
          <code class="code" id="-osq5v3_188">
           void*
          </code>
         </p>
        </td>
       </tr>
      </tbody>
     </table>
    </div>
    <p id="-osq5v3_100">
     The definition section of the
     <code class="code" id="-osq5v3_189">
      libnative_api.h
     </code>
     file shows how Kotlin primitive types are mapped to C primitive types. The Kotlin/Native compiler generates these entries automatically for every library. The reverse mapping is described in the
     <a data-tooltip="This is the first part of the Mapping Kotlin and C tutorial series." href="mapping-primitive-data-types-from-c.html" id="-osq5v3_190" style="color: blue;">
      Mapping primitive data types from C
     </a>
     tutorial.
    </p>
    <p id="-osq5v3_101">
     After the automatically generated type definitions, you'll find the separate type definitions used in your library:
    </p>
    <div class="code-block" data-lang="c" style="font-family: monospace; background: #f4f4f4; padding: 10px; overflow-x: auto; margin: 1em 0; display: block;">
     struct libnative_KType;
typedef struct libnative_KType libnative_KType;

/// Automatically generated type definitions

typedef struct {
  libnative_KNativePtr pinned;
} libnative_kref_example_Object;
typedef struct {
  libnative_KNativePtr pinned;
} libnative_kref_example_Clazz;
    </div>
    <p id="-osq5v3_103">
     In C, the
     <code class="code" id="-osq5v3_191">
      typedef struct { ... } TYPE_NAME
     </code>
     syntax declares the structure.
    </p>
    <aside class="prompt" data-title="" data-type="tip" id="-osq5v3_104">
     <p id="-osq5v3_192">
      See
      <a data-external="true" href="https://stackoverflow.com/questions/1675351/typedef-struct-vs-struct-definitions" id="-osq5v3_193" rel="noopener noreferrer" style="color: red;" target="_blank">
       this StackOverflow thread
      </a>
      for more explanations of this pattern.
     </p>
    </aside>
    <p id="-osq5v3_105">
     As you can see from these definitions, Kotlin types are mapped using the same pattern:
     <code class="code" id="-osq5v3_194">
      Object
     </code>
     is mapped to
     <code class="code" id="-osq5v3_195">
      libnative_kref_example_Object
     </code>
     , and
     <code class="code" id="-osq5v3_196">
      Clazz
     </code>
     is mapped to
     <code class="code" id="-osq5v3_197">
      libnative_kref_example_Clazz
     </code>
     . All structs contain nothing but the
     <code class="code" id="-osq5v3_198">
      pinned
     </code>
     field with a pointer. The field type
     <code class="code" id="-osq5v3_199">
      libnative_KNativePtr
     </code>
     is defined as
     <code class="code" id="-osq5v3_200">
      void*
     </code>
     earlier in the file.
    </p>
    <p id="-osq5v3_106">
     Since C doesn't support namespaces, the Kotlin/Native compiler generates long names to avoid any possible clashes with other symbols in the existing native project.
    </p>
    <section class="chapter">
     <h3 data-toc="service-runtime-functions" id="service-runtime-functions">
      Service runtime functions
     </h3>
     <p id="-osq5v3_201">
      The
      <code class="code" id="-osq5v3_209">
       libnative_ExportedSymbols
      </code>
      structure defines all the functions provided by Kotlin/Native and your library. It uses nested anonymous structures heavily to mimic packages. The
      <code class="code" id="-osq5v3_210">
       libnative_
      </code>
      prefix comes from the library name.
     </p>
     <p id="-osq5v3_202">
      <code class="code" id="-osq5v3_211">
       libnative_ExportedSymbols
      </code>
      includes several helper functions in the header file:
     </p>
     <div class="code-block" data-lang="c" style="font-family: monospace; background: #f4f4f4; padding: 10px; overflow-x: auto; margin: 1em 0; display: block;">
      typedef struct {
  /* Service functions. */
  void (*DisposeStablePointer)(libnative_KNativePtr ptr);
  void (*DisposeString)(const char* string);
     </div>
     <p id="-osq5v3_204">
      These functions deal with Kotlin/Native objects.
      <code class="code" id="-osq5v3_212">
       DisposeStablePointer
      </code>
      is called to release a reference to a Kotlin object, and
      <code class="code" id="-osq5v3_213">
       DisposeString
      </code>
      is called to release a Kotlin string, which has the
      <code class="code" id="-osq5v3_214">
       char*
      </code>
      type in C.
     </p>
     <p id="-osq5v3_205">
      The next part of the
      <code class="code" id="-osq5v3_215">
       libnative_api.h
      </code>
      file consists of structure declarations of runtime functions:
     </p>
     <div class="code-block" data-lang="c" style="font-family: monospace; background: #f4f4f4; padding: 10px; overflow-x: auto; margin: 1em 0; display: block;">
      libnative_KBoolean (*IsInstance)(libnative_KNativePtr ref, const libnative_KType* type);
libnative_KBoolean (*IsInstance)(libnative_KNativePtr ref, const libnative_KType* type);
libnative_kref_kotlin_Byte (*createNullableByte)(libnative_KByte);
libnative_KByte (*getNonNullValueOfByte)(libnative_kref_kotlin_Byte);
libnative_kref_kotlin_Short (*createNullableShort)(libnative_KShort);
libnative_KShort (*getNonNullValueOfShort)(libnative_kref_kotlin_Short);
libnative_kref_kotlin_Int (*createNullableInt)(libnative_KInt);
libnative_KInt (*getNonNullValueOfInt)(libnative_kref_kotlin_Int);
libnative_kref_kotlin_Long (*createNullableLong)(libnative_KLong);
libnative_KLong (*getNonNullValueOfLong)(libnative_kref_kotlin_Long);
libnative_kref_kotlin_Float (*createNullableFloat)(libnative_KFloat);
libnative_KFloat (*getNonNullValueOfFloat)(libnative_kref_kotlin_Float);
libnative_kref_kotlin_Double (*createNullableDouble)(libnative_KDouble);
libnative_KDouble (*getNonNullValueOfDouble)(libnative_kref_kotlin_Double);
libnative_kref_kotlin_Char (*createNullableChar)(libnative_KChar);
libnative_KChar (*getNonNullValueOfChar)(libnative_kref_kotlin_Char);
libnative_kref_kotlin_Boolean (*createNullableBoolean)(libnative_KBoolean);
libnative_KBoolean (*getNonNullValueOfBoolean)(libnative_kref_kotlin_Boolean);
libnative_kref_kotlin_Unit (*createNullableUnit)(void);
libnative_kref_kotlin_UByte (*createNullableUByte)(libnative_KUByte);
libnative_KUByte (*getNonNullValueOfUByte)(libnative_kref_kotlin_UByte);
libnative_kref_kotlin_UShort (*createNullableUShort)(libnative_KUShort);
libnative_KUShort (*getNonNullValueOfUShort)(libnative_kref_kotlin_UShort);
libnative_kref_kotlin_UInt (*createNullableUInt)(libnative_KUInt);
libnative_KUInt (*getNonNullValueOfUInt)(libnative_kref_kotlin_UInt);
libnative_kref_kotlin_ULong (*createNullableULong)(libnative_KULong);
libnative_KULong (*getNonNullValueOfULong)(libnative_kref_kotlin_ULong);
     </div>
     <p id="-osq5v3_207">
      You can use the
      <code class="code" id="-osq5v3_216">
       IsInstance
      </code>
      function to check if a Kotlin object (referenced with its
      <code class="code" id="-osq5v3_217">
       .pinned
      </code>
      pointer) is an instance of a type. The actual set of operations generated depends on actual usages.
     </p>
     <aside class="prompt" data-title="" data-type="tip" id="-osq5v3_208">
      <p id="-osq5v3_218">
       Kotlin/Native has its own garbage collector, but it doesn't manage Kotlin objects accessed from C. However, Kotlin/Native provides
       <a data-tooltip="The Objective-C libraries import is Experimental. All Kotlin declarations generated by the cinterop tool from Objective-C libraries should have the @ExperimentalForeignApi annotation." href="native-objc-interop.html" id="-osq5v3_219" style="color: blue;">
        interoperability with Swift/Objective-C
       </a>
       , and the garbage collector is
       <a data-tooltip="Kotlin and Objective-C use different memory management strategies. Kotlin has a tracing garbage collector, while Objective-C relies on automatic reference counting (ARC)." href="native-arc-integration.html" id="-osq5v3_220" style="color: blue;">
        integrated with Swift/Objective-C ARC
       </a>
       .
      </p>
     </aside>
    </section>
    <section class="chapter">
     <h3 data-toc="your-library-functions" id="your-library-functions">
      Your library functions
     </h3>
     <p id="-osq5v3_221">
      Let's take a look at the separate structure declarations used in your library. The
      <code class="code" id="-osq5v3_230">
       libnative_kref_example
      </code>
      field mimics the package structure of your Kotlin code with a
      <code class="code" id="-osq5v3_231">
       libnative_kref.
      </code>
      prefix:
     </p>
     <div class="code-block" data-lang="c" style="font-family: monospace; background: #f4f4f4; padding: 10px; overflow-x: auto; margin: 1em 0; display: block;">
      typedef struct {
  /* User functions. */
  struct {
    struct {
      struct {
        struct {
          libnative_KType* (*_type)(void);
          libnative_kref_example_Object (*_instance)();
          const char* (*get_field)(libnative_kref_example_Object thiz);
        } Object;
        struct {
          libnative_KType* (*_type)(void);
          libnative_kref_example_Clazz (*Clazz)();
          libnative_KULong (*memberFunction)(libnative_kref_example_Clazz thiz, libnative_KInt p);
        } Clazz;
        const char* (*get_globalString)();
        void (*forFloats)(libnative_KFloat f, libnative_KDouble d);
        void (*forIntegers)(libnative_KByte b, libnative_KShort s, libnative_KUInt i, libnative_KLong l);
        const char* (*strings)(const char* str);
      } example;
    } root;
  } kotlin;
} libnative_ExportedSymbols;
     </div>
     <p id="-osq5v3_223">
      The code uses anonymous structure declarations. Here,
      <code class="code" id="-osq5v3_232">
       struct { ... } foo
      </code>
      declares a field in the outer struct of the anonymous structure type, which has no name.
     </p>
     <p id="-osq5v3_224">
      Since C doesn't support objects either, function pointers are used to mimic object semantics. A function pointer is declared as
      <code class="code" id="-osq5v3_233">
       RETURN_TYPE (* FIELD_NAME)(PARAMETERS)
      </code>
      .
     </p>
     <p id="-osq5v3_225">
      The
      <code class="code" id="-osq5v3_234">
       libnative_kref_example_Clazz
      </code>
      field represents the
      <code class="code" id="-osq5v3_235">
       Clazz
      </code>
      from Kotlin. The
      <code class="code" id="-osq5v3_236">
       libnative_KULong
      </code>
      is accessible with the
      <code class="code" id="-osq5v3_237">
       memberFunction
      </code>
      field. The only difference is that the
      <code class="code" id="-osq5v3_238">
       memberFunction
      </code>
      accepts a
      <code class="code" id="-osq5v3_239">
       thiz
      </code>
      reference as the first parameter. Since C doesn't support objects, the
      <code class="code" id="-osq5v3_240">
       thiz
      </code>
      pointer is passed explicitly.
     </p>
     <p id="-osq5v3_226">
      There is a constructor in the
      <code class="code" id="-osq5v3_241">
       Clazz
      </code>
      field (aka
      <code class="code" id="-osq5v3_242">
       libnative_kref_example_Clazz_Clazz
      </code>
      ), which acts as the constructor function to create an instance of the
      <code class="code" id="-osq5v3_243">
       Clazz
      </code>
      .
     </p>
     <p id="-osq5v3_227">
      The Kotlin
      <code class="code" id="-osq5v3_244">
       object Object
      </code>
      is accessible as
      <code class="code" id="-osq5v3_245">
       libnative_kref_example_Object
      </code>
      . The
      <code class="code" id="-osq5v3_246">
       _instance
      </code>
      function retrieves the only instance of the object.
     </p>
     <p id="-osq5v3_228">
      Properties are translated into functions. The
      <code class="code" id="-osq5v3_247">
       get_
      </code>
      and
      <code class="code" id="-osq5v3_248">
       set_
      </code>
      prefixes name the getter and the setter functions, respectively. For example, the read-only property
      <code class="code" id="-osq5v3_249">
       globalString
      </code>
      from Kotlin is turned into a
      <code class="code" id="-osq5v3_250">
       get_globalString
      </code>
      function in C.
     </p>
     <p id="-osq5v3_229">
      Global functions
      <code class="code" id="-osq5v3_251">
       forFloats
      </code>
      ,
      <code class="code" id="-osq5v3_252">
       forIntegers
      </code>
      , and
      <code class="code" id="-osq5v3_253">
       strings
      </code>
      are turned into functions pointers in the
      <code class="code" id="-osq5v3_254">
       libnative_kref_example
      </code>
      anonymous struct.
     </p>
    </section>
    <section class="chapter">
     <h3 data-toc="entry-point" id="entry-point">
      Entry point
     </h3>
     <p id="-osq5v3_255">
      Now you know how the API is created, the initialization of the
      <code class="code" id="-osq5v3_259">
       libnative_ExportedSymbols
      </code>
      structure is the starting point. Let's then take a look at the final part of the
      <code class="code" id="-osq5v3_260">
       libnative_api.h
      </code>
      :
     </p>
     <div class="code-block" data-lang="c" style="font-family: monospace; background: #f4f4f4; padding: 10px; overflow-x: auto; margin: 1em 0; display: block;">
      extern libnative_ExportedSymbols* libnative_symbols(void);
     </div>
     <p id="-osq5v3_257">
      The
      <code class="code" id="-osq5v3_261">
       libnative_symbols
      </code>
      function allows you to open the gateway from the native code to the Kotlin/Native library. This is the entry point for accessing the library. The library name is used as a prefix for the function name.
     </p>
     <aside class="prompt" data-title="" data-type="note" id="-osq5v3_258">
      <p id="-osq5v3_262">
       It might be necessary to host the returned
       <code class="code" id="-osq5v3_263">
        libnative_ExportedSymbols*
       </code>
       pointer per thread.
      </p>
     </aside>
    </section>
   </section>
   <section class="chapter">
    <h2 data-toc="use-generated-headers-from-c" id="use-generated-headers-from-c">
     Use generated headers from C
    </h2>
    <p id="-osq5v3_264">
     Using the generated headers from C is straightforward. In the library directory, create the
     <code class="code" id="-osq5v3_266">
      main.c
     </code>
     file with the following code:
    </p>
    <div class="code-block" data-lang="c" style="font-family: monospace; background: #f4f4f4; padding: 10px; overflow-x: auto; margin: 1em 0; display: block;">
     #include "libnative_api.h"
#include "stdio.h"

int main(int argc, char** argv) {
  // Obtain reference for calling Kotlin/Native functions
  libnative_ExportedSymbols* lib = libnative_symbols();

  lib-&gt;kotlin.root.example.forIntegers(1, 2, 3, 4);
  lib-&gt;kotlin.root.example.forFloats(1.0f, 2.0);

  // Use C and Kotlin/Native strings
  const char* str = "Hello from Native!";
  const char* response = lib-&gt;kotlin.root.example.strings(str);
  printf("in: %s\nout:%s\n", str, response);
  lib-&gt;DisposeString(response);

  // Create Kotlin object instance
  libnative_kref_example_Clazz newInstance = lib-&gt;kotlin.root.example.Clazz.Clazz();
  long x = lib-&gt;kotlin.root.example.Clazz.memberFunction(newInstance, 42);
  lib-&gt;DisposeStablePointer(newInstance.pinned);

  printf("DemoClazz returned %ld\n", x);

  return 0;
}
    </div>
   </section>
   <section class="chapter">
    <h2 data-toc="compile-and-run-the-project" id="compile-and-run-the-project">
     Compile and run the project
    </h2>
    <section class="chapter">
     <h3 data-toc="on-macos" id="on-macos">
      On macOS
     </h3>
     <p id="-osq5v3_270">
      To compile the C code and link it with the dynamic library, navigate to the library directory and run the following command:
     </p>
     <div class="code-block" data-lang="bash" style="font-family: monospace; background: #f4f4f4; padding: 10px; overflow-x: auto; margin: 1em 0; display: block;">
      clang main.c libnative.dylib
     </div>
     <p id="-osq5v3_272">
      The compiler generates an executable called
      <code class="code" id="-osq5v3_273">
       a.out
      </code>
      . Run it to execute the Kotlin code from the C library.
     </p>
    </section>
    <section class="chapter">
     <h3 data-toc="on-linux" id="on-linux">
      On Linux
     </h3>
     <p id="-osq5v3_274">
      To compile the C code and link it with the dynamic library, navigate to the library directory and run the following command:
     </p>
     <div class="code-block" data-lang="bash" style="font-family: monospace; background: #f4f4f4; padding: 10px; overflow-x: auto; margin: 1em 0; display: block;">
      gcc main.c libnative.so
     </div>
     <p id="-osq5v3_276">
      The compiler generates an executable called
      <code class="code" id="-osq5v3_277">
       a.out
      </code>
      . Run it to execute the Kotlin code from the C library. On Linux, you need to include
      <code class="code" id="-osq5v3_278">
       .
      </code>
      into the
      <code class="code" id="-osq5v3_279">
       LD_LIBRARY_PATH
      </code>
      to let the application know to load the
      <code class="code" id="-osq5v3_280">
       libnative.so
      </code>
      library from the current folder.
     </p>
    </section>
    <section class="chapter">
     <h3 data-toc="on-windows" id="on-windows">
      On Windows
     </h3>
     <p id="-osq5v3_281">
      First, you'll need to install a Microsoft Visual C++ compiler that supports the x64_64 target.
     </p>
     <p id="-osq5v3_282">
      The easiest way to do this is to install Microsoft Visual Studio on a Windows machine. During installation, select the necessary components to work with C++, for example,
      <span class="control" id="-osq5v3_286">
       Desktop development with C++
      </span>
      .
     </p>
     <p id="-osq5v3_283">
      On Windows, you can include dynamic libraries either by generating a static library wrapper or manually with the
      <a data-external="true" href="https://learn.microsoft.com/en-gb/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya" id="-osq5v3_287" rel="noopener noreferrer" style="color: red;" target="_blank">
       LoadLibrary
      </a>
      or similar Win32API functions.
     </p>
     <p id="-osq5v3_284">
      Let's use the first option and generate the static wrapper library for the
      <code class="code" id="-osq5v3_288">
       libnative.dll
      </code>
      :
     </p>
     <ol class="list _decimal" id="-osq5v3_285" type="1">
      <li class="list__item" id="-osq5v3_289">
       <p id="-osq5v3_291">
        Call
        <code class="code" id="-osq5v3_293">
         lib.exe
        </code>
        from the toolchain to generate the static library wrapper
        <code class="code" id="-osq5v3_294">
         libnative.lib
        </code>
        that automates the DLL usage from the code:
       </p>
       <div class="code-block" data-lang="bash" style="font-family: monospace; background: #f4f4f4; padding: 10px; overflow-x: auto; margin: 1em 0; display: block;">
        lib /def:libnative.def /out:libnative.lib
       </div>
      </li>
      <li class="list__item" id="-osq5v3_290">
       <p id="-osq5v3_295">
        Compile your
        <code class="code" id="-osq5v3_298">
         main.c
        </code>
        into an executable. Include the generated
        <code class="code" id="-osq5v3_299">
         libnative.lib
        </code>
        into the build command and start:
       </p>
       <div class="code-block" data-lang="bash" style="font-family: monospace; background: #f4f4f4; padding: 10px; overflow-x: auto; margin: 1em 0; display: block;">
        cl.exe main.c libnative.lib
       </div>
       <p id="-osq5v3_297">
        The command produces the
        <code class="code" id="-osq5v3_300">
         main.exe
        </code>
        file, which you can run.
       </p>
      </li>
     </ol>
    </section>
   </section>
   <section class="chapter">
    <h2 data-toc="what-s-next" id="what-s-next">
     What's next
    </h2>
    <ul class="list _bullet" id="-osq5v3_301">
     <li class="list__item" id="-osq5v3_302">
      <p id="-osq5v3_304">
       <a data-tooltip="The Objective-C libraries import is Experimental. All Kotlin declarations generated by the cinterop tool from Objective-C libraries should have the @ExperimentalForeignApi annotation." href="native-objc-interop.html" id="-osq5v3_305" style="color: blue;">
        Learn more about interoperability with Swift/Objective-C
       </a>
      </p>
     </li>
     <li class="list__item" id="-osq5v3_303">
      <p id="-osq5v3_306">
       <a data-tooltip="The Objective-C libraries import is Experimental. All Kotlin declarations generated by the cinterop tool from Objective-C libraries should have the @ExperimentalForeignApi annotation." href="apple-framework.html" id="-osq5v3_307" style="color: blue;">
        Check out the Kotlin/Native as an Apple framework tutorial
       </a>
      </p>
     </li>
    </ul>
   </section>
   <div class="last-modified">
    19 April 2025
   </div>
   <div data-feedback-placeholder="true">
   </div>
  </article>
 </body>
</html>
