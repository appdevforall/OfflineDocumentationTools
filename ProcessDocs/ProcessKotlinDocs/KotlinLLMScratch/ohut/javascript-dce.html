<html>
 <head>
  <meta charset="utf-8"/>
  <title>
   Kotlin Documentation
  </title>
  <link href="style.css" rel="stylesheet"/>
 </head>
 <body>
  <div style="text-align: center; margin-bottom: 1em;">
   <a href="toc.html" style="font-size: 24px; text-decoration: none;">
    Menu
   </a>
  </div>
  <article class="article" data-shortcut-switcher="inactive">
   <h1 data-toc="javascript-dce" id="javascript-dce.md">
    Kotlin/JS dead code elimination
   </h1>
   <aside class="prompt" data-title="" data-type="warning" id="z7as5sw_2">
    <p id="z7as5sw_10">
     The dead code elimination (DCE) tool is deprecated. The DCE tool was designed for the legacy JS backend, which is now obsolete. The current
     <a data-tooltip="The application of DCE with the IR compiler is as follows:" href="#dce-and-javascript-ir-compiler" id="z7as5sw_11" style="color: blue;">
      JS IR backend
     </a>
     supports DCE out of the box, and the
     <a data-external="true" href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.js/-js-export/" id="z7as5sw_12" rel="noopener noreferrer" style="color: red;" target="_blank">
      @JsExport annotation
     </a>
     allows specifying which Kotlin functions and classes to retain during DCE.
    </p>
   </aside>
   <p id="z7as5sw_3">
    The Kotlin Multiplatform Gradle plugin includes a
    <span class="emphasis" id="z7as5sw_13">
     <a data-external="true" href="https://wikipedia.org/wiki/Dead_code_elimination" id="z7as5sw_16" rel="noopener noreferrer" style="color: red;" target="_blank">
      dead code elimination
     </a>
    </span>
    (
    <span class="emphasis" id="z7as5sw_14">
     DCE
    </span>
    ) tool. Dead code elimination is often also called
    <span class="emphasis" id="z7as5sw_15">
     tree shaking
    </span>
    . It reduces the size or the resulting JavaScript code by removing unused properties, functions, and classes.
   </p>
   <p id="z7as5sw_4">
    Unused declarations can appear in cases like:
   </p>
   <ul class="list _bullet" id="z7as5sw_5">
    <li class="list__item" id="z7as5sw_17">
     <p id="z7as5sw_19">
      A function is inlined and never gets called directly (which happens always except for a few situations).
     </p>
    </li>
    <li class="list__item" id="z7as5sw_18">
     <p id="z7as5sw_20">
      A module uses a shared library. Without DCE, parts of the library that you don't use are still included in the resulting bundle. For example, the Kotlin standard library contains functions for manipulating lists, arrays, char sequences, adapters for DOM, and so on. All of this functionality would require about 1.3 MB as a JavaScript file. A simple "Hello, world" application only requires console routines, which is only few kilobytes for the entire file.
     </p>
    </li>
   </ul>
   <p id="z7as5sw_6">
    The Kotlin Multiplatform Gradle plugin handles DCE automatically when you build a
    <span class="control" id="z7as5sw_21">
     production bundle
    </span>
    , for example by using the
    <code class="code" id="z7as5sw_22">
     browserProductionWebpack
    </code>
    task.
    <span class="control" id="z7as5sw_23">
     Development bundling
    </span>
    tasks (like
    <code class="code" id="z7as5sw_24">
     browserDevelopmentWebpack
    </code>
    ) don't include DCE.
   </p>
   <section class="chapter">
    <h2 data-toc="dce-and-javascript-ir-compiler" id="dce-and-javascript-ir-compiler">
     DCE and JavaScript IR compiler
    </h2>
    <p id="z7as5sw_25">
     The application of DCE with the IR compiler is as follows:
    </p>
    <ul class="list _bullet" id="z7as5sw_26">
     <li class="list__item" id="z7as5sw_28">
      <p id="z7as5sw_30">
       DCE is disabled when compiling for development, which corresponds to the following Gradle tasks:
      </p>
      <ul class="list _bullet" id="z7as5sw_31">
       <li class="list__item" id="z7as5sw_32">
        <p id="z7as5sw_38">
         <code class="code" id="z7as5sw_39">
          browserDevelopmentRun
         </code>
        </p>
       </li>
       <li class="list__item" id="z7as5sw_33">
        <p id="z7as5sw_40">
         <code class="code" id="z7as5sw_41">
          browserDevelopmentWebpack
         </code>
        </p>
       </li>
       <li class="list__item" id="z7as5sw_34">
        <p id="z7as5sw_42">
         <code class="code" id="z7as5sw_43">
          nodeDevelopmentRun
         </code>
        </p>
       </li>
       <li class="list__item" id="z7as5sw_35">
        <p id="z7as5sw_44">
         <code class="code" id="z7as5sw_45">
          compileDevelopmentExecutableKotlinJs
         </code>
        </p>
       </li>
       <li class="list__item" id="z7as5sw_36">
        <p id="z7as5sw_46">
         <code class="code" id="z7as5sw_47">
          compileDevelopmentLibraryKotlinJs
         </code>
        </p>
       </li>
       <li class="list__item" id="z7as5sw_37">
        <p id="z7as5sw_48">
         Other Gradle tasks including "development" in their name
        </p>
       </li>
      </ul>
     </li>
     <li class="list__item" id="z7as5sw_29">
      <p id="z7as5sw_49">
       DCE is enabled when compiling for production, which corresponds to the following Gradle tasks:
      </p>
      <ul class="list _bullet" id="z7as5sw_50">
       <li class="list__item" id="z7as5sw_51">
        <p id="z7as5sw_56">
         <code class="code" id="z7as5sw_57">
          browserProductionRun
         </code>
        </p>
       </li>
       <li class="list__item" id="z7as5sw_52">
        <p id="z7as5sw_58">
         <code class="code" id="z7as5sw_59">
          browserProductionWebpack
         </code>
        </p>
       </li>
       <li class="list__item" id="z7as5sw_53">
        <p id="z7as5sw_60">
         <code class="code" id="z7as5sw_61">
          compileProductionExecutableKotlinJs
         </code>
        </p>
       </li>
       <li class="list__item" id="z7as5sw_54">
        <p id="z7as5sw_62">
         <code class="code" id="z7as5sw_63">
          compileProductionLibraryKotlinJs
         </code>
        </p>
       </li>
       <li class="list__item" id="z7as5sw_55">
        <p id="z7as5sw_64">
         Other Gradle tasks including "production" in their name
        </p>
       </li>
      </ul>
     </li>
    </ul>
    <p id="z7as5sw_27">
     With the @JsExport annotation, you can specify the declarations you want DCE to treat as roots.
    </p>
   </section>
   <section class="chapter">
    <h2 data-toc="exclude-declarations-from-dce" id="exclude-declarations-from-dce">
     Exclude declarations from DCE
    </h2>
    <p id="z7as5sw_65">
     Sometimes you may need to keep a function or a class in the resulting JavaScript code even if you don't use it in your module, for example, if you're going to use it in the client JavaScript code.
    </p>
    <p id="z7as5sw_66">
     To keep certain declarations from elimination, add the
     <code class="code" id="z7as5sw_71">
      dceTask
     </code>
     block to your Gradle build script and list the declarations as arguments of the
     <code class="code" id="z7as5sw_72">
      keep
     </code>
     function. An argument must be the declaration's fully qualified name with the module name as a prefix:
     <code class="code" id="z7as5sw_73">
      moduleName.dot.separated.package.name.declarationName
     </code>
    </p>
    <aside class="prompt" data-title="" data-type="note" id="z7as5sw_67">
     <p id="z7as5sw_74">
      Unless specified otherwise, the names of functions and modules can be
      <a data-tooltip="In some cases (for example, to support overloads), the Kotlin compiler mangles the names of generated functions and attributes in JavaScript code. To control the generated names, you can use the @JsName annotation:" href="js-to-kotlin-interop.html#jsname-annotation" id="z7as5sw_75" style="color: blue;">
       mangled
      </a>
      in the generated JavaScript code. To keep such functions from elimination, use the mangled names in the
      <code class="code" id="z7as5sw_76">
       keep
      </code>
      arguments as they appear in the generated JavaScript code.
     </p>
    </aside>
    <div class="code-block" data-lang="groovy" style="font-family: monospace; background: #f4f4f4; padding: 10px; overflow-x: auto; margin: 1em 0; display: block;">
     kotlin {
    js {
        browser {
            dceTask {
                keep("myKotlinJSModule.org.example.getName", "myKotlinJSModule.org.example.User" )
            }
            binaries.executable()
        }
    }
}
    </div>
    <p id="z7as5sw_69">
     If you want to keep a whole package or module from elimination, you can use its fully qualified name as it appears in the generated JavaScript code.
    </p>
    <aside class="prompt" data-title="" data-type="note" id="z7as5sw_70">
     <p id="z7as5sw_77">
      Keeping whole packages or modules from elimination can prevent DCE from removing many unused declarations. Because of this, it is preferable to select individual declarations which should be excluded from DCE one by one.
     </p>
    </aside>
   </section>
   <section class="chapter">
    <h2 data-toc="disable-dce" id="disable-dce">
     Disable DCE
    </h2>
    <p id="z7as5sw_78">
     To turn off DCE completely, use the
     <code class="code" id="z7as5sw_80">
      devMode
     </code>
     option in the
     <code class="code" id="z7as5sw_81">
      dceTask
     </code>
     :
    </p>
    <div class="code-block" data-lang="groovy" style="font-family: monospace; background: #f4f4f4; padding: 10px; overflow-x: auto; margin: 1em 0; display: block;">
     kotlin {
    js {
        browser {
            dceTask {
                dceOptions.devMode = true
            }
        }
        binaries.executable()
    }
}
    </div>
   </section>
   <div class="last-modified">
    19 April 2025
   </div>
   <div data-feedback-placeholder="true">
   </div>
  </article>
 </body>
</html>
