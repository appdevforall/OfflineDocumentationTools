<html>
 <head>
  <meta charset="utf-8"/>
  <title>
   Kotlin Documentation
  </title>
  <link href="style.css" rel="stylesheet"/>
 </head>
 <body>
  <div style="text-align: center; margin-bottom: 1em;">
   <a href="toc.html" style="font-size: 24px; text-decoration: none;">
    Menu
   </a>
  </div>
  <article class="article" data-shortcut-switcher="inactive">
   <h1 data-toc="gradle-plugin-variants" id="gradle-plugin-variants.md">
    Support for Gradle plugin variants
   </h1>
   <p id="-pega3g_2">
    Gradle 7.0 introduced a new feature for Gradle plugin authors —
    <a data-external="true" href="https://docs.gradle.org/7.0/userguide/implementing_gradle_plugins.html#plugin-with-variants" id="-pega3g_10" rel="noopener noreferrer" style="color: red;" target="_blank">
     plugins with variants
    </a>
    . This feature makes it easier to add support for latest Gradle features while maintaining compatibility with older Gradle versions. Learn more about
    <a data-external="true" href="https://docs.gradle.org/current/userguide/variant_model.html" id="-pega3g_11" rel="noopener noreferrer" style="color: red;" target="_blank">
     variant selection in Gradle
    </a>
    .
   </p>
   <p id="-pega3g_3">
    With Gradle plugin variants, the Kotlin team can ship different Kotlin Gradle plugin (KGP) variants for different Gradle versions. The goal is to support the base Kotlin compilation in the
    <code class="code" id="-pega3g_12">
     main
    </code>
    variant, which corresponds to the oldest supported versions of Gradle. Each variant will have implementations for Gradle features from a corresponding release. The latest variant will support the latest Gradle feature set. With this approach, it is possible to extend support for older Gradle versions with limited functionality.
   </p>
   <p id="-pega3g_4">
    Currently, there are the following variants of the Kotlin Gradle plugin:
   </p>
   <div class="table-wrapper">
    <table class="wide" id="-pega3g_5">
     <thead>
      <tr class="ijRowHead" id="-pega3g_13">
       <th id="-pega3g_19">
        <p>
         Variant's name
        </p>
       </th>
       <th id="-pega3g_20">
        <p>
         Corresponding Gradle versions
        </p>
       </th>
      </tr>
     </thead>
     <tbody>
      <tr id="-pega3g_14">
       <td id="-pega3g_21">
        <p>
         <code class="code" id="-pega3g_23">
          main
         </code>
        </p>
       </td>
       <td id="-pega3g_22">
        <p>
         7.6.0–7.6.3
        </p>
       </td>
      </tr>
      <tr id="-pega3g_15">
       <td id="-pega3g_24">
        <p>
         <code class="code" id="-pega3g_26">
          gradle80
         </code>
        </p>
       </td>
       <td id="-pega3g_25">
        <p>
         8.0–8.0.2
        </p>
       </td>
      </tr>
      <tr id="-pega3g_16">
       <td id="-pega3g_27">
        <p>
         <code class="code" id="-pega3g_29">
          gradle81
         </code>
        </p>
       </td>
       <td id="-pega3g_28">
        <p>
         8.1.1
        </p>
       </td>
      </tr>
      <tr id="-pega3g_17">
       <td id="-pega3g_30">
        <p>
         <code class="code" id="-pega3g_32">
          gradle82
         </code>
        </p>
       </td>
       <td id="-pega3g_31">
        <p>
         8.2.1–8.4
        </p>
       </td>
      </tr>
      <tr id="-pega3g_18">
       <td id="-pega3g_33">
        <p>
         <code class="code" id="-pega3g_35">
          gradle85
         </code>
        </p>
       </td>
       <td id="-pega3g_34">
        <p>
         8.5 and higher
        </p>
       </td>
      </tr>
     </tbody>
    </table>
   </div>
   <p id="-pega3g_6">
    In future Kotlin releases, more variants will be added.
   </p>
   <p id="-pega3g_7">
    To check which variant your build uses, enable the
    <a data-external="true" href="https://docs.gradle.org/current/userguide/logging.html#sec:choosing_a_log_level" id="-pega3g_36" rel="noopener noreferrer" style="color: red;" target="_blank">
     <code class="code" id="-pega3g_39">
      --info
     </code>
     log level
    </a>
    and find a string in the output starting with
    <code class="code" id="-pega3g_37">
     Using Kotlin Gradle plugin
    </code>
    , for example,
    <code class="code" id="-pega3g_38">
     Using Kotlin Gradle plugin main variant
    </code>
    .
   </p>
   <section class="chapter">
    <h2 data-toc="troubleshooting" id="troubleshooting">
     Troubleshooting
    </h2>
    <aside class="prompt" data-title="" data-type="note" id="-pega3g_40">
     <p id="-pega3g_42">
      Here are workarounds for some known issues with variant selection in Gradle:
     </p>
     <ul class="list _bullet" id="-pega3g_43">
      <li class="list__item" id="-pega3g_44">
       <p id="-pega3g_46">
        <a data-external="true" href="https://github.com/gradle/gradle/issues/20545" id="-pega3g_47" rel="noopener noreferrer" style="color: red;" target="_blank">
         ResolutionStrategy in pluginManagement is not working for plugins with multivariants
        </a>
       </p>
      </li>
      <li class="list__item" id="-pega3g_45">
       <p id="-pega3g_48">
        <a data-external="true" href="https://github.com/gradle/gradle/issues/20847" id="-pega3g_49" rel="noopener noreferrer" style="color: red;" target="_blank">
         Plugin variants are ignored when a plugin is added as the
         <code class="code" id="-pega3g_50">
          buildSrc
         </code>
         common dependency
        </a>
       </p>
      </li>
     </ul>
    </aside>
    <section class="chapter">
     <h3 data-toc="gradle-can-t-select-a-kgp-variant-in-a-custom-configuration" id="gradle-can-t-select-a-kgp-variant-in-a-custom-configuration">
      Gradle can't select a KGP variant in a custom configuration
     </h3>
     <p id="-pega3g_51">
      This is an expected situation that Gradle can't select a KGP variant in a custom configuration. If you use a custom Gradle configuration:
     </p>
     <div class="tabs" data-anchors="[-pega3g_59,-pega3g_60]" data-group="build-script" id="-pega3g_52">
      <div class="tabs__content" data-gtm="tab" data-sync-tabs="kotlin" data-title="Kotlin" id="-pega3g_59">
       <div class="code-block" data-lang="kotlin" data-title="Kotlin" style="font-family: monospace; background: #f4f4f4; padding: 10px; overflow-x: auto; margin: 1em 0; display: block;">
        configurations.register("customConfiguration") {
    // ...
}
       </div>
      </div>
      <div class="tabs__content" data-gtm="tab" data-sync-tabs="groovy" data-title="Groovy" id="-pega3g_60">
       <div class="code-block" data-lang="groovy" data-title="Groovy" style="font-family: monospace; background: #f4f4f4; padding: 10px; overflow-x: auto; margin: 1em 0; display: block;">
        configurations.register("customConfiguration") {
    // ...
}
       </div>
      </div>
     </div>
     <p id="-pega3g_53">
      And want to add a dependency on the Kotlin Gradle plugin, for example:
     </p>
     <div class="tabs" data-anchors="[-pega3g_63,-pega3g_64]" data-group="build-script" id="-pega3g_54">
      <div class="tabs__content" data-gtm="tab" data-sync-tabs="kotlin" data-title="Kotlin" id="-pega3g_63">
       <div class="code-block" data-lang="kotlin" data-title="Kotlin" style="font-family: monospace; background: #f4f4f4; padding: 10px; overflow-x: auto; margin: 1em 0; display: block;">
        dependencies {
    customConfiguration("org.jetbrains.kotlin:kotlin-gradle-plugin:2.1.20")
}
       </div>
      </div>
      <div class="tabs__content" data-gtm="tab" data-sync-tabs="groovy" data-title="Groovy" id="-pega3g_64">
       <div class="code-block" data-lang="groovy" data-title="Groovy" style="font-family: monospace; background: #f4f4f4; padding: 10px; overflow-x: auto; margin: 1em 0; display: block;">
        dependencies {
    customConfiguration 'org.jetbrains.kotlin:kotlin-gradle-plugin:2.1.20'
}
       </div>
      </div>
     </div>
     <p id="-pega3g_55">
      You need to add the following attributes to your
      <code class="code" id="-pega3g_67">
       customConfiguration
      </code>
      :
     </p>
     <div class="tabs" data-anchors="[-pega3g_68,-pega3g_69]" data-group="build-script" id="-pega3g_56">
      <div class="tabs__content" data-gtm="tab" data-sync-tabs="kotlin" data-title="Kotlin" id="-pega3g_68">
       <div class="code-block" data-lang="kotlin" data-title="Kotlin" style="font-family: monospace; background: #f4f4f4; padding: 10px; overflow-x: auto; margin: 1em 0; display: block;">
        configurations {
    customConfiguration {
        attributes {
            attribute(
                Usage.USAGE_ATTRIBUTE,
                project.objects.named(Usage.class, Usage.JAVA_RUNTIME)
            )
            attribute(
                Category.CATEGORY_ATTRIBUTE,
                project.objects.named(Category.class, Category.LIBRARY)
            )
            // If you want to depend on a specific KGP variant:
            attribute(
                GradlePluginApiVersion.GRADLE_PLUGIN_API_VERSION_ATTRIBUTE,
                project.objects.named("7.0")
            )
        }
    }
}
       </div>
      </div>
      <div class="tabs__content" data-gtm="tab" data-sync-tabs="groovy" data-title="Groovy" id="-pega3g_69">
       <div class="code-block" data-lang="groovy" data-title="Groovy" style="font-family: monospace; background: #f4f4f4; padding: 10px; overflow-x: auto; margin: 1em 0; display: block;">
        configurations {
    customConfiguration {
        attributes {
            attribute(
                Usage.USAGE_ATTRIBUTE,
                project.objects.named(Usage, Usage.JAVA_RUNTIME)
            )
            attribute(
                Category.CATEGORY_ATTRIBUTE,
                project.objects.named(Category, Category.LIBRARY)
            )
            // If you want to depend on a specific KGP variant:
            attribute(
                GradlePluginApiVersion.GRADLE_PLUGIN_API_VERSION_ATTRIBUTE,
                project.objects.named('7.0')
            )
        }
    }
}
       </div>
      </div>
     </div>
     <p id="-pega3g_57">
      Otherwise, you will receive an error similar to this:
     </p>
     <div class="code-block" data-lang="none" style="font-family: monospace; background: #f4f4f4; padding: 10px; overflow-x: auto; margin: 1em 0; display: block;">
      &gt; Could not resolve all files for configuration ':customConfiguration'.
      &gt; Could not resolve org.jetbrains.kotlin:kotlin-gradle-plugin:1.7.0.
        Required by:
            project :
         &gt; Cannot choose between the following variants of org.jetbrains.kotlin:kotlin-gradle-plugin:1.7.0:
             - gradle70RuntimeElements
             - runtimeElements
           All of them match the consumer attributes:
             - Variant 'gradle70RuntimeElements' capability org.jetbrains.kotlin:kotlin-gradle-plugin:1.7.0:
                 - Unmatched attributes:
     </div>
    </section>
   </section>
   <section class="chapter">
    <h2 data-toc="what-s-next" id="what-s-next">
     What's next?
    </h2>
    <p id="-pega3g_72">
     Learn more about
     <a data-external="true" href="https://docs.gradle.org/current/userguide/userguide.html" id="-pega3g_73" rel="noopener noreferrer" style="color: red;" target="_blank">
      Gradle basics and specifics
     </a>
     .
    </p>
   </section>
   <div class="last-modified">
    19 April 2025
   </div>
   <div data-feedback-placeholder="true">
   </div>
  </article>
 </body>
</html>
